<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:cc="clr-namespace:IncStores.TaskManager.WpfTaskViewer.CustomControls">
    
    <!-- BRUSHES -->
    <SolidColorBrush x:Key="RecipeProgress.WorkerParent.Background" Color="{StaticResource Global.Main.Light.Color}" />
    <SolidColorBrush x:Key="RecipeProgress.WorkerParent.Working.Foreground" Color="{StaticResource Global.Accent.Color}" />
    <SolidColorBrush x:Key="RecipeProgress.RecipeHeader.Foreground" Color="{StaticResource Global.SecondaryAccent.Color}" />
    <SolidColorBrush x:Key="RecipeProgress.TasksHeader.Foreground" Color="{StaticResource Global.SecondaryAccent.Color}" />

    <!-- TEMPLATE -->
    <ControlTemplate x:Key="BaseRecipeProgressTemplate" TargetType="{x:Type cc:RecipeProgress}">
        <cc:ContentSection>
            
            <!-- HEADER -->
            <cc:ContentSection.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="Recipe Workers:" FontWeight="Bold" />
                    <TextBlock Grid.Column="1" Text="[+]" HorizontalAlignment="Right" Style="{StaticResource HyperlinkTextBlock}" />
                </Grid>
            </cc:ContentSection.Header>
            
            <!-- RECIPE WORKERS -->
            <ItemsControl ItemsSource="{TemplateBinding RecipeProgressSource}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>

                        <!-- WORKER PARENT -->
                        <cc:ContentSection x:Name="workerParent"
                                           Background="{StaticResource RecipeProgress.WorkerParent.Background}"
                                           Margin="0,10,0,0">

                            <!-- WORKER PARENT HEADER -->
                            <cc:ContentSection.Header>
                                <TextBlock>
                                <Run Text="{Binding WorkerNumber, StringFormat={}Worker #{0} - }" />
                                <Run Text="{Binding WorkerStatus, Mode=OneWay}">
                                    <Run.Style>
                                        <Style TargetType="{x:Type Run}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding WorkerStatus}" Value="Working">
                                                    <Setter Property="Foreground" Value="{StaticResource RecipeProgress.WorkerParent.Working.Foreground}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Run.Style>
                                </Run>
                                </TextBlock>
                            </cc:ContentSection.Header>
                            
                            <!-- WORKER CONTENT -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="{x:Type StackPanel}">
                                        <Style.Triggers>
                                            <!-- HIDE WORKER CONTENT IF NO RECIPE INFORMATION AVAILABLE (IDLE) -->
                                            <DataTrigger Binding="{Binding WorkerStatus}" Value="Idle">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                
                                <!-- RECIPE INFO -->
                                <TextBlock Text="{Binding RecipeStatus.RecipeId, StringFormat={}Recipe ID: ({0})}" Foreground="{StaticResource RecipeProgress.RecipeHeader.Foreground}" Margin="0,10,0,0" />
                                <TextBlock Text="{Binding RecipeStatus.RecipeName}" FontStyle="Italic" />
                                <ProgressBar Minimum="0" Maximum="100" Value="{Binding RecipeStatus.Progress}" Height="5" IsIndeterminate="{Binding RecipeStatus.IsIndeterminate}" />
                                
                                <!-- TASK DATA -->
                                <StackPanel x:Name="taskDataContainer" Margin="0,5">
                                    <Separator Margin="10,5" />

                                    <TextBlock Text="Tasks" Foreground="{StaticResource RecipeProgress.TasksHeader.Foreground}" />
                                    <ItemsControl ItemsSource="{Binding RecipeStatus.TaskStatuses}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding TaskName}" FontStyle="Italic" />
                                                    <ProgressBar Minimum="0" Maximum="100" Value="{Binding Progress}" Height="5" IsIndeterminate="{Binding IsIndeterminate}" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                            </StackPanel>

                        </cc:ContentSection>

                        <!-- TRIGGERS -->
                        <DataTemplate.Triggers>
                            <!-- REMOVE TOP MARGIN ON FIRST WORKER -->
                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=PreviousData}}" Value="{x:Null}">
                                <!--<Setter Property="Margin" TargetName="workerParent" Value="0" />-->
                            </DataTrigger>
                            
                            <!-- HIDE TASK CONTAINER IF NO TASK PROGRESS IS REPORTED -->
                            <DataTrigger Binding="{Binding RecipeStatus.TaskStatuses.Count}" Value="0">
                                <Setter Property="Visibility" TargetName="taskDataContainer" Value="Collapsed" />
                            </DataTrigger>
                        </DataTemplate.Triggers>

                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </cc:ContentSection>
    </ControlTemplate>
    
    <!-- STYLE -->
    <Style TargetType="{x:Type cc:RecipeProgress}">
        <Setter Property="Template" Value="{StaticResource BaseRecipeProgressTemplate}" />
    </Style>
    
</ResourceDictionary>