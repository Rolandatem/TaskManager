<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:converters="clr-namespace:IncStores.TaskManager.WpfTaskViewer.Converters">

    <!-- BRUSHES -->
    <SolidColorBrush x:Key="MainMenu.Background" Color="{StaticResource Global.Main.Light.Color}" />
    <SolidColorBrush x:Key="MainMenu.Highlight.Background" Color="{StaticResource Global.Main.Lighter.Color}" />
    <SolidColorBrush x:Key="MainMenu.Highlight.Border" Color="{StaticResource Global.SecondaryAccent.Color}" />
    <SolidColorBrush x:Key="MainMenu.Disabled.Foreground" Color="#FF707070" />
    <SolidColorBrush x:Key="MainMenu.RightArrow.Fill" Color="#FFD4D4D4" />

    <!-- CONVERTERS -->
    <converters:MenuItemIsEnabledMultiBindingConverter x:Key="menuItemIsEnabledMultiBindingConverter" />
    <converters:StringToICommandConverter x:Key="stringToICommandConverter" />

    <!-- DRAWINGS -->
    <Geometry x:Key="RightArrow">M 0,0 L 4,3.5 L 0,7 Z</Geometry>
    
    <!-- TOP LEVEL ACTION MENU ITEM -->
    <ControlTemplate x:Key="{ComponentResourceKey ResourceId=TopLevelItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
        <Border x:Name="templateRoot" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Height="{TemplateBinding Height}" Padding="{TemplateBinding Padding}">
            <ContentPresenter ContentSource="Header" />
        </Border>
        <ControlTemplate.Triggers>
            <Trigger Property="IsHighlighted" Value="True">
                <Setter Property="Background" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Background}" />
                <Setter Property="BorderBrush" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Border}" />
            </Trigger>
            <Trigger Property="IsEnabled" Value="False">
                <Setter Property="TextElement.Foreground" TargetName="templateRoot" Value="{StaticResource MainMenu.Disabled.Foreground}"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>
    
    <!-- TOP LEVEL PARENT MENU ITEM -->
    <ControlTemplate x:Key="{ComponentResourceKey ResourceId=TopLevelHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
        <Border x:Name="templateRoot" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Height="{TemplateBinding Height}" Padding="{TemplateBinding Padding}">
            <Grid>
                <ContentPresenter ContentSource="Header" />
                <Popup x:Name="PART_Popup" Focusable="False" VerticalOffset="-1" IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}" Placement="Right" PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}" PlacementTarget="{Binding ElementName=templateRoot}">
                    <Border Background="{StaticResource MainMenu.Background}" Padding="5" BorderBrush="Black" BorderThickness="0,1,0,1">
                        <ItemsPresenter x:Name="ItemsPresenter" KeyboardNavigation.DirectionalNavigation="Cycle" Grid.IsSharedSizeScope="True" KeyboardNavigation.TabNavigation="Cycle" />
                    </Border>
                </Popup>
            </Grid>
        </Border>
        <ControlTemplate.Triggers>
            <Trigger Property="IsHighlighted" Value="True">
                <Setter Property="Background" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Background}"/>
                <Setter Property="BorderBrush" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Border}"/>
            </Trigger>
            <Trigger Property="IsEnabled" Value="False">
                <Setter Property="TextElement.Foreground" TargetName="templateRoot" Value="{StaticResource MainMenu.Disabled.Foreground}"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>
    
    <!-- ACTION SUB MENU ITEM -->
    <ControlTemplate x:Key="{ComponentResourceKey ResourceId=SubmenuItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
        <Border x:Name="templateRoot" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Height="{TemplateBinding Height}" Padding="{TemplateBinding Padding}">
            <ContentPresenter x:Name="menuHeaderContainer" Grid.Column="0" ContentSource="Header" HorizontalAlignment="Left" VerticalAlignment="Center" />
        </Border>
        <ControlTemplate.Triggers>
            <Trigger Property="IsHighlighted" Value="True">
                <Setter Property="Background" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Background}" />
                <Setter Property="BorderBrush" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Border}"/>
            </Trigger>
            <Trigger Property="IsEnabled" Value="False">
                <Setter Property="TextElement.Foreground" TargetName="templateRoot" Value="{StaticResource MainMenu.Disabled.Foreground}"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>
    
    <!-- PARENT SUB MENU ITEM -->
    <ControlTemplate x:Key="{ComponentResourceKey ResourceId=SubmenuHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}" TargetType="{x:Type MenuItem}">
        <Border x:Name="templateRoot" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Height="{TemplateBinding Height}" Padding="{TemplateBinding Padding}">
            <Grid Margin="-1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="20" />
                </Grid.ColumnDefinitions>

                <ContentPresenter Grid.Column="0" ContentSource="Header" HorizontalAlignment="Left" VerticalAlignment="Center" />
                <Path x:Name="RightArrow" Grid.Column="1" Data="{StaticResource RightArrow}" Fill="{StaticResource MainMenu.RightArrow.Fill}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                <Popup x:Name="PART_Popup" Focusable="False" HorizontalOffset="11" VerticalOffset="-7" IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}" Placement="Right" PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}">
                    <Border Background="{StaticResource MainMenu.Background}" Padding="5" BorderBrush="Black" BorderThickness="0,1,1,1">
                        <ItemsPresenter x:Name="ItemsPresenter" KeyboardNavigation.DirectionalNavigation="Cycle" Grid.IsSharedSizeScope="True" KeyboardNavigation.TabNavigation="Cycle" />
                    </Border>
                </Popup>
            </Grid>
        </Border>
        <ControlTemplate.Triggers>
            <Trigger Property="IsHighlighted" Value="True">
                <Setter Property="Background" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Background}" />
                <Setter Property="BorderBrush" TargetName="templateRoot" Value="{StaticResource MainMenu.Highlight.Border}"/>
            </Trigger>
            <Trigger Property="IsEnabled" Value="False">
                <Setter Property="TextElement.Foreground" TargetName="templateRoot" Value="{StaticResource MainMenu.Disabled.Foreground}"/>
                <Setter Property="Fill" TargetName="RightArrow" Value="{StaticResource MainMenu.Disabled.Foreground}"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>
    <Style x:Key="MainMenu.Menu.Style" TargetType="{x:Type Menu}">
        <Setter Property="Background" Value="{StaticResource MainMenu.Background}" />
    </Style>
    <Style x:Key="MainMenu.MenuItem.Style" TargetType="{x:Type MenuItem}">
        <Setter Property="Command">
            <Setter.Value>
                <MultiBinding Converter="{StaticResource stringToICommandConverter}">
                    <Binding Path="Command" />
                    <Binding Path="DataContext" RelativeSource="{RelativeSource AncestorType={x:Type Menu}, Mode=FindAncestor}" />
                </MultiBinding>
            </Setter.Value>
        </Setter>
        <Setter Property="IsEnabled">
            <Setter.Value>
                <MultiBinding Converter="{StaticResource menuItemIsEnabledMultiBindingConverter}">
                    <Binding Path="." />
                    <Binding Path="DataContext.SharedHubCommunicator.IsConnectedToSignalRServer" RelativeSource="{RelativeSource AncestorType={x:Type Window}}" />
                </MultiBinding>
            </Setter.Value>
        </Setter>
        
        <Style.Triggers>
            <Trigger Property="Role" Value="TopLevelHeader">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Height" Value="30" />
                <Setter Property="BorderBrush" Value="Transparent" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="6,0" />
                <Setter Property="Template" Value="{DynamicResource {ComponentResourceKey ResourceId=TopLevelHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}"/>
            </Trigger>
            <Trigger Property="Role" Value="TopLevelItem">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Height" Value="30" />
                <Setter Property="BorderBrush" Value="Transparent" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="6,0" />
                <Setter Property="Template" Value="{DynamicResource {ComponentResourceKey ResourceId=TopLevelItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}"/>
            </Trigger>
            <Trigger Property="Role" Value="SubmenuHeader">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Height" Value="30" />
                <Setter Property="BorderBrush" Value="Transparent" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="6,1"/>
                <Setter Property="Template" Value="{DynamicResource {ComponentResourceKey ResourceId=SubmenuHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}"/>
            </Trigger>
            <Trigger Property="Role" Value="SubmenuItem">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Height" Value="30" />
                <Setter Property="BorderBrush" Value="Transparent" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="6,1" />
                <Setter Property="Template" Value="{DynamicResource {ComponentResourceKey ResourceId=SubmenuItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}" />
            </Trigger>
        </Style.Triggers>
    </Style>
</ResourceDictionary>